name: BRL-CAD

on: [push]

jobs:

  linux:
    name: Ubuntu Latest GCC
    runs-on: ubuntu-latest
    strategy:
      fail-fast: true
    steps:
      - name: Setup - CMake
        uses: lukka/get-cmake@latest

      - name: Setup - System
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
          sudo apt-get update
          # Install X/OpenGL dev pkgs
          sudo apt-get install xserver-xorg-dev libx11-dev libxi-dev libxext-dev libglu1-mesa-dev
          sudo apt-get clean

      - name: Setup - Qt
        uses: jurplel/install-qt-action@v3
        with:
          cache: 'true'

      - name: Checkout
        uses: actions/checkout@v4

      - name: Build Directory setup
        run: |
          mkdir build

      - name: bext checkout
        uses: actions/checkout@v4
        with:
          name: BRL-CAD/bext
          path: ./build/bext

      - name: Configure
        run: |
          export PATH=$ENV{GITHUB_WORKSPACE}:$PATH
          cmake -S . -G Ninja -B build -DCMAKE_BUILD_TYPE=Release DBRLCAD_ENABLE_STEP=OFF -DBRLCAD_ENABLE_GDAL=OFF

      - name: Build
        run: |
          export PATH=$ENV{GITHUB_WORKSPACE}:$PATH
          cmake --build build --config Release --target check
          cmake --build build --config Release --target package

        # For the moment the space demands are too extreme to enable this
        # output for every compile test, but leave the enabling logic present
        # in commented out form so it can be enabled as needed.
#     - name: Upload Package
#       uses: actions/upload-artifact@v2
#       with:
#         name: BRLCAD_Linux
#         path: ${{ github.workspace }}/build/BRL-CAD*gz


